const http = require('http');
const url = require('url');
var request = require('request');
var JefNode = require('json-easy-filter').JefNode;






module.exports = (req) => {
     return new Promise((resolve, reject) => {
         //对request请求的url进行判断，是否为post方法
         console.log(req.method.toLowerCase());
             if(req.method.toLowerCase() =='get'){
                 var mCurrentPage = 0;
                 mCurrentPage + 1 ;
                 request('http://gank.io/api/data/%E7%A6%8F%E5%88%A9/20/'+ mCurrentPage ,function (error,response,body) {
                     if(!error && response.statusCode == 200){
                          console.log(body);
                         mCurrentPage = mCurrentPage;
                         var photo1 = JSON.parse(body);
                         var photourl1 = new JefNode(photo1).filter(function(node) {
                             if (node.has('url')) {
                                 return  node.value.url;
                             }
                         });
                         console.log(photourl1);
                         resolve (photourl1);
                     }
                 })

                 console.log("One");
                 resolve();
             }else if (req.method.toLowerCase() =='post'){
                 var mCurrentPage = 0;
                 mCurrentPage + 1 ;
                 var requrl = '';
                 request('http://gank.io/api/data/%E7%A6%8F%E5%88%A9/20/'+ mCurrentPage ,function (error,response,body) {
                     if(!error && response.statusCode == 200){
                        // console.log(body);
                         mCurrentPage = mCurrentPage;
                         var photo2 = JSON.parse(body);
                         var photourl2 = new JefNode(photo2).filter(function(node) {
                             if (node.has('url')) {
                                 return  node.value.url;
                             }
                         });
                        // console.log(photourl);
                       //  var itemList = [];
                       //  for (var i = 0 ; i < photourl.length;i ++)
                      //       itemList.push({urls:photourl[i]});
                       //  console.log(itemList)
                         resolve (photourl2);
                         }
                 })

                 console.log("Two");
             }else {
                 console.log("Three");
                 reject("Other");
             }
	});
}